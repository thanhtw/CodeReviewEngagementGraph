<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å“è³ªæŒ‡æ¨™èˆ‡æˆç¸¾ç›¸é—œä¿‚æ•¸åˆ†æ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 20px;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .navigation {
            text-align: center;
            margin: 20px 0;
        }
        
        .nav-button {
            display: inline-block;
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            transition: background-color 0.3s;
        }
        
        .nav-button:hover {
            background-color: #2980b9;
        }
        
        .analysis-section {
            margin: 40px 0;
        }
        
        .section-title {
            color: #2c3e50;
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin-bottom: 20px;
        }
        
        .correlation-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        
        .correlation-matrix {
            background-color: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .heatmap-table {
            border-collapse: collapse;
            margin: 0 auto;
            font-size: 14px;
        }
        
        .heatmap-table th, .heatmap-table td {
            width: 80px;
            height: 50px;
            text-align: center;
            vertical-align: middle;
            border: 1px solid #ddd;
            font-weight: bold;
        }
        
        .heatmap-table th {
            background-color: #f8f9fa;
            color: #2c3e50;
            font-size: 12px;
        }
        
        .heatmap-table .row-header {
            background-color: #f8f9fa;
            color: #2c3e50;
            font-weight: bold;
            width: 60px;
        }
        
        .insights {
            background-color: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 20px;
            margin: 30px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .insights h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        
        .insights ul {
            margin: 15px 0;
            padding-left: 20px;
        }
        
        .insights li {
            margin: 10px 0;
        }
        
        .data-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .summary-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .summary-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }
        
        .summary-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .color-legend {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            font-size: 14px;
            font-weight: bold;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 0 20px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
        }
        
        .positive-corr { color: #dc2626; }
        .negative-corr { color: #1e40af; }
        .neutral-corr { color: #6b7280; }
        
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .heatmap-table { font-size: 12px; }
            .heatmap-table th, .heatmap-table td { width: 60px; height: 40px; }
            .color-legend { flex-direction: column; }
            .legend-item { margin: 5px 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š å“è³ªæŒ‡æ¨™èˆ‡æˆç¸¾ç›¸é—œä¿‚æ•¸åˆ†æ</h1>
            <p>åˆ†æå­¸ç”Ÿè©•è«–å“è³ªæŒ‡æ¨™ï¼ˆç›¸é—œæ€§ã€å…·é«”æ€§ã€å»ºè¨­æ€§ï¼‰èˆ‡å­¸æœŸæˆç¸¾çš„é—œè¯æ€§</p>
        </div>
        
        <div class="navigation">
            <a href="graph.html" class="nav-button">â† è¿”å›ä¸»é é¢</a>
            <a href="descriptive_statistics.html" class="nav-button">æè¿°æ€§çµ±è¨ˆ</a>
            <a href="multipleRegressionReport.html" class="nav-button">å¤šå…ƒå›æ­¸åˆ†æ</a>
        </div>

        <div class="data-summary" id="data-summary">
            <!-- è³‡æ–™æ¦‚è¦½å°‡åœ¨é€™è£¡å‹•æ…‹è¼‰å…¥ -->
        </div>

        <div class="analysis-section">
            <h2 class="section-title">ğŸ“ˆ ç›¸é—œä¿‚æ•¸çŸ©é™£ç†±åŠ›åœ–</h2>
            
            <div class="correlation-container">
                <div class="correlation-matrix">
                    <table class="heatmap-table" id="correlation-heatmap">
                        <!-- ç›¸é—œä¿‚æ•¸çŸ©é™£å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                    </table>
                </div>
            </div>
            
            <div class="color-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #1e40af;"></div>
                    <span class="negative-corr">è² ç›¸é—œ (è—è‰²)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #f1f5f9;"></div>
                    <span class="neutral-corr">ç„¡ç›¸é—œ (æ·ºç°)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #dc2626;"></div>
                    <span class="positive-corr">æ­£ç›¸é—œ (ç´…è‰²)</span>
                </div>
            </div>
        </div>

        <div class="insights">
            <h3>ğŸ” åˆ†ææ´å¯Ÿ</h3>
            <ul>
                <li><strong>å“è³ªæŒ‡æ¨™é–“ç›¸é—œæ€§ï¼š</strong>ç›¸é—œæ€§ã€å…·é«”æ€§ã€å»ºè¨­æ€§ä¸‰å€‹å“è³ªæŒ‡æ¨™ä¹‹é–“å¯èƒ½å­˜åœ¨ä¸åŒç¨‹åº¦çš„ç›¸é—œ</li>
                <li><strong>æˆç¸¾é–“ç›¸é—œæ€§ï¼š</strong>æœŸä¸­ã€æœŸæœ«ã€å­¸æœŸæˆç¸¾ä¹‹é–“é€šå¸¸å…·æœ‰è¼ƒé«˜æ­£ç›¸é—œæ€§</li>
                <li><strong>å“è³ª-æˆç¸¾é—œè¯ï¼š</strong>é«˜å“è³ªè©•è«–æŒ‡æ¨™å¯èƒ½èˆ‡è¼ƒä½³çš„å­¸ç¿’æˆæœç›¸é—œ</li>
                <li><strong>æ•™å­¸æ‡‰ç”¨ï¼š</strong>é€éç›¸é—œæ€§åˆ†æï¼Œå¯ä»¥è­˜åˆ¥å“ªäº›å“è³ªæŒ‡æ¨™å°å­¸ç”Ÿæˆç¸¾å½±éŸ¿æœ€å¤§</li>
                <li><strong>è‰²å½©èªªæ˜ï¼š</strong>
                    <span class="positive-corr">ç´…è‰²è¡¨ç¤ºæ­£ç›¸é—œ</span>ï¼Œ
                    <span class="negative-corr">è—è‰²è¡¨ç¤ºè² ç›¸é—œ</span>ï¼Œ
                    é¡è‰²æ·±åº¦è¡¨ç¤ºç›¸é—œæ€§å¼·åº¦
                </li>
            </ul>
        </div>

        <div class="analysis-section">
            <h2 class="section-title">ğŸ“‹ è©³ç´°ç›¸é—œä¿‚æ•¸è¡¨æ ¼</h2>
            <div id="detailed-correlation-table">
                <!-- è©³ç´°ç›¸é—œä¿‚æ•¸è¡¨æ ¼å°‡åœ¨é€™è£¡å‹•æ…‹è¼‰å…¥ -->
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ“¬ç›¸é—œä¿‚æ•¸è³‡æ–™ï¼ˆèˆ‡é™„åœ–ä¸€è‡´ï¼‰
        const correlationData = {
            'ç›¸é—œæ€§': { 'ç›¸é—œæ€§': 1.000, 'å…·é«”æ€§': 0.530, 'å»ºè¨­æ€§': 0.307, 'æœŸä¸­': 0.141, 'æœŸæœ«': 0.038, 'å­¸æœŸ': 0.142 },
            'å…·é«”æ€§': { 'ç›¸é—œæ€§': 0.530, 'å…·é«”æ€§': 1.000, 'å»ºè¨­æ€§': 0.703, 'æœŸä¸­': 0.256, 'æœŸæœ«': 0.157, 'å­¸æœŸ': 0.222 },
            'å»ºè¨­æ€§': { 'ç›¸é—œæ€§': 0.307, 'å…·é«”æ€§': 0.703, 'å»ºè¨­æ€§': 1.000, 'æœŸä¸­': 0.149, 'æœŸæœ«': 0.063, 'å­¸æœŸ': 0.080 },
            'æœŸä¸­': { 'ç›¸é—œæ€§': 0.141, 'å…·é«”æ€§': 0.256, 'å»ºè¨­æ€§': 0.149, 'æœŸä¸­': 1.000, 'æœŸæœ«': 0.830, 'å­¸æœŸ': 0.887 },
            'æœŸæœ«': { 'ç›¸é—œæ€§': 0.038, 'å…·é«”æ€§': 0.157, 'å»ºè¨­æ€§': 0.063, 'æœŸä¸­': 0.830, 'æœŸæœ«': 1.000, 'å­¸æœŸ': 0.935 },
            'å­¸æœŸ': { 'ç›¸é—œæ€§': 0.142, 'å…·é«”æ€§': 0.222, 'å»ºè¨­æ€§': 0.080, 'æœŸä¸­': 0.887, 'æœŸæœ«': 0.935, 'å­¸æœŸ': 1.000 }
        };

        const variables = ['ç›¸é—œæ€§', 'å…·é«”æ€§', 'å»ºè¨­æ€§', 'æœŸä¸­', 'æœŸæœ«', 'å­¸æœŸ'];

        // æ ¹æ“šç›¸é—œä¿‚æ•¸å€¼æ±ºå®šé¡è‰²
        function getCorrelationColor(value) {
            const absValue = Math.abs(value);
            let intensity;
            
            if (absValue >= 0.8) intensity = 1;
            else if (absValue >= 0.6) intensity = 0.8;
            else if (absValue >= 0.4) intensity = 0.6;
            else if (absValue >= 0.2) intensity = 0.4;
            else intensity = 0.2;

            if (value > 0.1) {
                // æ­£ç›¸é—œ - ç´…è‰²ç³»
                const red = Math.floor(220 - (1-intensity) * 50);
                const green = Math.floor(50 + (1-intensity) * 150);
                const blue = Math.floor(50 + (1-intensity) * 150);
                return `rgb(${red}, ${green}, ${blue})`;
            } else if (value < -0.1) {
                // è² ç›¸é—œ - è—è‰²ç³»
                const red = Math.floor(50 + (1-intensity) * 150);
                const green = Math.floor(100 + (1-intensity) * 150);
                const blue = Math.floor(220 - (1-intensity) * 50);
                return `rgb(${red}, ${green}, ${blue})`;
            } else {
                // æ¥è¿‘ç„¡ç›¸é—œ - æ·ºç°è‰²
                return '#f1f5f9';
            }
        }

        // ç”Ÿæˆç›¸é—œä¿‚æ•¸çŸ©é™£ç†±åŠ›åœ–
        function generateHeatmap() {
            const table = document.getElementById('correlation-heatmap');
            
            // å»ºç«‹æ¨™é¡Œè¡Œ
            let headerHtml = '<tr><th></th>';
            variables.forEach(variable => {
                headerHtml += `<th>${variable}</th>`;
            });
            headerHtml += '</tr>';
            
            // å»ºç«‹è³‡æ–™è¡Œ
            let bodyHtml = '';
            variables.forEach(rowVar => {
                bodyHtml += `<tr><td class="row-header">${rowVar}</td>`;
                variables.forEach(colVar => {
                    const value = correlationData[rowVar][colVar];
                    const color = getCorrelationColor(value);
                    const textColor = Math.abs(value) > 0.5 ? 'white' : 'black';
                    
                    bodyHtml += `<td style="background-color: ${color}; color: ${textColor};">
                        ${value.toFixed(3)}
                    </td>`;
                });
                bodyHtml += '</tr>';
            });
            
            table.innerHTML = headerHtml + bodyHtml;
        }

        // ç”Ÿæˆè³‡æ–™æ¦‚è¦½
        function generateDataSummary() {
            const container = document.getElementById('data-summary');
            
            // è¨ˆç®—çµ±è¨ˆé‡
            let totalCorrelations = 0;
            let strongCorrelations = 0;
            let maxCorrelation = 0;
            let maxPair = '';
            
            variables.forEach(rowVar => {
                variables.forEach(colVar => {
                    if (rowVar !== colVar) {
                        const value = Math.abs(correlationData[rowVar][colVar]);
                        totalCorrelations++;
                        
                        if (value > 0.5) strongCorrelations++;
                        
                        if (value > maxCorrelation) {
                            maxCorrelation = value;
                            maxPair = `${rowVar} vs ${colVar}`;
                        }
                    }
                });
            });
            
            totalCorrelations = totalCorrelations / 2; // é¿å…é‡è¤‡è¨ˆç®—
            strongCorrelations = strongCorrelations / 2;
            
            container.innerHTML = `
                <div class="summary-card">
                    <div class="summary-value">${variables.length}</div>
                    <div class="summary-label">åˆ†æè®Šæ•¸</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value">${totalCorrelations}</div>
                    <div class="summary-label">ç›¸é—œä¿‚æ•¸å°æ•¸</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value">${strongCorrelations}</div>
                    <div class="summary-label">å¼·ç›¸é—œï¼ˆ>0.5ï¼‰</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value">${maxCorrelation.toFixed(3)}</div>
                    <div class="summary-label">æœ€é«˜ç›¸é—œä¿‚æ•¸</div>
                </div>
            `;
        }

        // ç”Ÿæˆè©³ç´°ç›¸é—œä¿‚æ•¸è¡¨æ ¼
        function generateDetailedTable() {
            const container = document.getElementById('detailed-correlation-table');
            
            let tableHtml = `
                <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                    <thead>
                        <tr style="background-color: #f8f9fa;">
                            <th style="border: 1px solid #ddd; padding: 12px; text-align: center;">è®Šæ•¸1</th>
                            <th style="border: 1px solid #ddd; padding: 12px; text-align: center;">è®Šæ•¸2</th>
                            <th style="border: 1px solid #ddd; padding: 12px; text-align: center;">ç›¸é—œä¿‚æ•¸</th>
                            <th style="border: 1px solid #ddd; padding: 12px; text-align: center;">ç›¸é—œç¨‹åº¦</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // ç”Ÿæˆæ‰€æœ‰è®Šæ•¸å°çš„ç›¸é—œä¿‚æ•¸
            for (let i = 0; i < variables.length; i++) {
                for (let j = i + 1; j < variables.length; j++) {
                    const var1 = variables[i];
                    const var2 = variables[j];
                    const correlation = correlationData[var1][var2];
                    
                    let degree = '';
                    const abs = Math.abs(correlation);
                    if (abs >= 0.8) degree = 'å¾ˆå¼·';
                    else if (abs >= 0.6) degree = 'å¼·';
                    else if (abs >= 0.4) degree = 'ä¸­ç­‰';
                    else if (abs >= 0.2) degree = 'å¼±';
                    else degree = 'å¾ˆå¼±';
                    
                    const sign = correlation > 0 ? 'æ­£' : 'è² ';
                    degree = sign + degree;
                    
                    const colorClass = correlation > 0 ? 'positive-corr' : 'negative-corr';
                    
                    tableHtml += `
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">${var1}</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">${var2}</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">
                                <span class="${colorClass}">${correlation.toFixed(3)}</span>
                            </td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">${degree}ç›¸é—œ</td>
                        </tr>
                    `;
                }
            }
            
            tableHtml += '</tbody></table>';
            container.innerHTML = tableHtml;
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            generateDataSummary();
            generateHeatmap();
            generateDetailedTable();
        });
    </script>
</body>
</html>
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .correlation-table th,
        .correlation-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #ddd;
            position: relative;
        }
        .correlation-table th {
            background-color: #34495e;
            color: white;
            font-weight: bold;
        }
        .correlation-table tr:hover {
            background-color: #f8f9fa;
        }
        .strong-positive {
            background-color: #d4edda !important;
            color: #155724;
            font-weight: bold;
        }
        .moderate-positive {
            background-color: #fff3cd !important;
            color: #856404;
        }
        .weak-correlation {
            background-color: #f8f9fa !important;
            color: #6c757d;
        }
        .moderate-negative {
            background-color: #f8d7da !important;
            color: #721c24;
        }
        .strong-negative {
            background-color: #f5c6cb !important;
            color: #721c24;
            font-weight: bold;
        }
        .chart-container {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .chart-canvas {
            width: 200px;
            height: 150px;
            max-width: 100%;
        }
        .chart-canvas-small {
            width: 250px;
            height: 180px;
            max-width: 100%;
        }
        .interpretation {
            background-color: #fef9e7;
            border-left: 4px solid #f1c40f;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .interpretation h4 {
            color: #2c3e50;
            margin-top: 0;
        }
        .significance-legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            padding: 5px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 3px;
        }
        .navigation {
            text-align: center;
            margin: 30px 0;
        }
        .nav-button {
            display: inline-block;
            padding: 12px 24px;
            margin: 0 10px;
            background-color: #e74c3c;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            transition: background-color 0.3s;
        }
        .nav-button:hover {
            background-color: #c0392b;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .stat-card h4 {
            color: #2c3e50;
            margin-top: 0;
            border-bottom: 2px solid #e74c3c;
            padding-bottom: 10px;
        }
        .correlation-value {
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
        }
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 1024px) {
            .chart-canvas {
                width: 100%;
                height: 200px;
            }
            .chart-canvas-small {
                width: 100%;
                height: 250px;
            }
        }
        @media (max-width: 768px) {
            .chart-canvas {
                width: 100%;
                height: 180px;
            }
            .chart-canvas-small {
                width: 100%;
                height: 220px;
            }
            .container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ˆ ç›¸é—œä¿‚æ•¸åˆ†æå ±å‘Š</h1>
        
        <div class="navigation">
            <a href="multipleRegressionReport.html" class="nav-button">å¤šå…ƒå›æ­¸åˆ†æ</a>
            <a href="descriptive_statistics.html" class="nav-button">æè¿°æ€§çµ±è¨ˆ</a>
            <a href="graph.html" class="nav-button">å›åˆ°ä¸»é é¢</a>
        </div>

        <div class="significance-legend">
            <h3 style="grid-column: 1 / -1; margin: 0; color: #2c3e50;">ç›¸é—œä¿‚æ•¸å¼·åº¦èªªæ˜</h3>
            <div class="legend-item">
                <div class="legend-color strong-positive"></div>
                <span>å¼·æ­£ç›¸é—œ (|r| â‰¥ 0.7)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color moderate-positive"></div>
                <span>ä¸­ç­‰æ­£ç›¸é—œ (0.3 â‰¤ |r| < 0.7)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color weak-correlation"></div>
                <span>å¼±ç›¸é—œ (|r| < 0.3)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color moderate-negative"></div>
                <span>ä¸­ç­‰è² ç›¸é—œ (-0.7 < r â‰¤ -0.3)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color strong-negative"></div>
                <span>å¼·è² ç›¸é—œ (r â‰¤ -0.7)</span>
            </div>
        </div>

        <div id="correlation-analysis">
            <!-- ç›¸é—œåˆ†æçµæœå°‡åœ¨é€™è£¡å‹•æ…‹è¼‰å…¥ -->
        </div>

        <div class="chart-container">
            <h3>ç›¸é—œä¿‚æ•¸ç†±åœ–</h3>
            <canvas id="correlationHeatmap" class="chart-canvas"></canvas>
        </div>

        <div class="chart-container">
            <h3>ç›¸é—œä¿‚æ•¸é•·æ¢åœ–</h3>
            <canvas id="correlationBarChart" class="chart-canvas-small"></canvas>
        </div>
    </div>

    <script>
        let correlationData = null;

        // è¼‰å…¥ç›¸é—œåˆ†æè³‡æ–™
        async function loadCorrelationData() {
            try {
                const response = await fetch('grade_correlation_results.json');
                correlationData = await response.json();
                displayCorrelationResults();
                createCharts();
            } catch (error) {
                console.error('è¼‰å…¥è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                document.getElementById('correlation-analysis').innerHTML = 
                    '<p style="color: red; text-align: center;">è¼‰å…¥è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥è³‡æ–™æª”æ¡ˆæ˜¯å¦å­˜åœ¨ã€‚</p>';
            }
        }

        // é¡¯ç¤ºç›¸é—œåˆ†æçµæœ
        function displayCorrelationResults() {
            if (!correlationData) return;

            const container = document.getElementById('correlation-analysis');
            let html = '<h2>ğŸ“Š ç›¸é—œä¿‚æ•¸çŸ©é™£</h2>';

            // é¡¯ç¤ºç›¸é—œä¿‚æ•¸çŸ©é™£
            if (correlationData.correlation_matrix) {
                html += '<div class="correlation-matrix">';
                html += '<table class="correlation-table">';
                
                // å»ºç«‹è¡¨é ­
                const variables = Object.keys(correlationData.correlation_matrix);
                html += '<thead><tr><th>è®Šæ•¸</th>';
                variables.forEach(variable => {
                    html += `<th>${variable}</th>`;
                });
                html += '</tr></thead><tbody>';

                // å»ºç«‹è¡¨æ ¼å…§å®¹
                variables.forEach(rowVar => {
                    html += `<tr><th>${rowVar}</th>`;
                    variables.forEach(colVar => {
                        const correlation = correlationData.correlation_matrix[rowVar][colVar];
                        const cellClass = getCorrelationClass(correlation);
                        html += `<td class="${cellClass}">${correlation.toFixed(3)}</td>`;
                    });
                    html += '</tr>';
                });

                html += '</tbody></table></div>';
            }

            // é¡¯ç¤ºé‡è¦ç›¸é—œä¿‚æ•¸
            html += '<div class="stats-grid">';
            
            if (correlationData.significant_correlations) {
                html += '<div class="stat-card">';
                html += '<h4>ğŸ¯ é¡¯è‘—ç›¸é—œä¿‚æ•¸ (p < 0.05)</h4>';
                correlationData.significant_correlations.forEach(corr => {
                    const corrClass = getCorrelationClass(corr.correlation);
                    html += `
                        <div class="correlation-value ${corrClass}">
                            ${corr.variable1} â†” ${corr.variable2}<br>
                            r = ${corr.correlation.toFixed(3)} (p = ${corr.p_value.toFixed(4)})
                        </div>`;
                });
                html += '</div>';
            }

            if (correlationData.grade_correlations) {
                html += '<div class="stat-card">';
                html += '<h4>ğŸ“š æˆç¸¾ç›¸é—œåˆ†æ</h4>';
                Object.entries(correlationData.grade_correlations).forEach(([grade, correlations]) => {
                    html += `<h5>${grade}</h5>`;
                    Object.entries(correlations).forEach(([variable, correlation]) => {
                        if (variable !== grade) {
                            const corrClass = getCorrelationClass(correlation);
                            html += `
                                <div class="correlation-value ${corrClass}">
                                    èˆ‡ ${variable}: r = ${correlation.toFixed(3)}
                                </div>`;
                        }
                    });
                });
                html += '</div>';
            }

            html += '</div>';

            // æ·»åŠ è§£é‡‹
            html += `
                <div class="interpretation">
                    <h4>çµæœè§£é‡‹</h4>
                    <ul>
                        <li><strong>ç›¸é—œä¿‚æ•¸ç¯„åœï¼š</strong> -1 åˆ° +1ï¼Œæ•¸å€¼è¶Šæ¥è¿‘ Â±1 è¡¨ç¤ºç›¸é—œæ€§è¶Šå¼·</li>
                        <li><strong>æ­£ç›¸é—œï¼š</strong> ä¸€å€‹è®Šæ•¸å¢åŠ æ™‚ï¼Œå¦ä¸€å€‹è®Šæ•¸ä¹Ÿå‚¾å‘å¢åŠ </li>
                        <li><strong>è² ç›¸é—œï¼š</strong> ä¸€å€‹è®Šæ•¸å¢åŠ æ™‚ï¼Œå¦ä¸€å€‹è®Šæ•¸å‚¾å‘æ¸›å°‘</li>
                        <li><strong>çµ±è¨ˆé¡¯è‘—æ€§ï¼š</strong> p å€¼ < 0.05 è¡¨ç¤ºç›¸é—œä¿‚æ•¸åœ¨çµ±è¨ˆä¸Šé¡¯è‘—</li>
                        <li><strong>å¯¦éš›æ„ç¾©ï¼š</strong> å³ä½¿çµ±è¨ˆé¡¯è‘—ï¼Œä¹Ÿéœ€è€ƒæ…®ç›¸é—œä¿‚æ•¸çš„å¤§å°ä¾†åˆ¤æ–·å¯¦éš›é‡è¦æ€§</li>
                    </ul>
                </div>`;

            container.innerHTML = html;
        }

        // æ ¹æ“šç›¸é—œä¿‚æ•¸å¤§å°æ±ºå®šæ¨£å¼é¡åˆ¥
        function getCorrelationClass(correlation) {
            const absCorr = Math.abs(correlation);
            if (absCorr >= 0.7) {
                return correlation > 0 ? 'strong-positive' : 'strong-negative';
            } else if (absCorr >= 0.3) {
                return correlation > 0 ? 'moderate-positive' : 'moderate-negative';
            } else {
                return 'weak-correlation';
            }
        }

        // å‰µå»ºåœ–è¡¨
        function createCharts() {
            if (!correlationData) return;

            if (correlationData.correlation_matrix) {
                createCorrelationHeatmap();
                createCorrelationBarChart();
            }
        }

        // å‰µå»ºç›¸é—œä¿‚æ•¸ç†±åœ–
        function createCorrelationHeatmap() {
            const ctx = document.getElementById('correlationHeatmap').getContext('2d');
            
            // å¼·åˆ¶è¨­å®š canvas å°ºå¯¸
            const canvas = ctx.canvas;
            canvas.width = 200;
            canvas.height = 150;
            
            const variables = Object.keys(correlationData.correlation_matrix);
            const data = [];

            variables.forEach((rowVar, i) => {
                variables.forEach((colVar, j) => {
                    data.push({
                        x: j,
                        y: i,
                        v: correlationData.correlation_matrix[rowVar][colVar]
                    });
                });
            });

            new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'ç›¸é—œä¿‚æ•¸',
                        data: data,
                        backgroundColor: function(context) {
                            const value = context.parsed.v;
                            if (value >= 0.7) return 'rgba(46, 204, 113, 0.8)';
                            if (value >= 0.3) return 'rgba(241, 196, 15, 0.8)';
                            if (value >= -0.3) return 'rgba(189, 195, 199, 0.8)';
                            if (value >= -0.7) return 'rgba(230, 126, 34, 0.8)';
                            return 'rgba(231, 76, 60, 0.8)';
                        }
                    }]
                },
                options: {
                    responsive: false,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            min: -0.5,
                            max: variables.length - 0.5,
                            ticks: {
                                stepSize: 1,
                                font: {
                                    size: 9
                                },
                                callback: function(value, index) {
                                    return variables[value] || '';
                                }
                            },
                            title: {
                                display: true,
                                text: 'è®Šæ•¸',
                                font: {
                                    size: 10
                                }
                            }
                        },
                        y: {
                            type: 'linear',
                            min: -0.5,
                            max: variables.length - 0.5,
                            ticks: {
                                stepSize: 1,
                                font: {
                                    size: 9
                                },
                                callback: function(value, index) {
                                    return variables[value] || '';
                                }
                            },
                            title: {
                                display: true,
                                text: 'è®Šæ•¸',
                                font: {
                                    size: 10
                                }
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'ç›¸é—œä¿‚æ•¸ç†±åœ–',
                            font: {
                                size: 12
                            }
                        },
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    const point = context[0];
                                    return `${variables[point.parsed.y]} vs ${variables[point.parsed.x]}`;
                                },
                                label: function(context) {
                                    return `ç›¸é—œä¿‚æ•¸: ${context.parsed.v.toFixed(3)}`;
                                }
                            }
                        }
                    }
                });
        }

        // å‰µå»ºç›¸é—œä¿‚æ•¸é•·æ¢åœ–
        function createCorrelationBarChart() {
            const ctx = document.getElementById('correlationBarChart').getContext('2d');
            
            // å¼·åˆ¶è¨­å®š canvas å°ºå¯¸
            const canvas = ctx.canvas;
            canvas.width = 250;
            canvas.height = 180;
            
            // æ”¶é›†æ‰€æœ‰éå°è§’ç·šçš„ç›¸é—œä¿‚æ•¸
            const correlations = [];
            const labels = [];
            const variables = Object.keys(correlationData.correlation_matrix);

            variables.forEach((rowVar, i) => {
                variables.forEach((colVar, j) => {
                    if (i < j) {  // åªå–ä¸Šä¸‰è§’çŸ©é™£ï¼Œé¿å…é‡è¤‡
                        const correlation = correlationData.correlation_matrix[rowVar][colVar];
                        correlations.push(correlation);
                        labels.push(`${rowVar} - ${colVar}`);
                    }
                });
            });

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ç›¸é—œä¿‚æ•¸',
                        data: correlations,
                        backgroundColor: correlations.map(corr => {
                            const absCorr = Math.abs(corr);
                            if (absCorr >= 0.7) return corr > 0 ? '#2ecc71' : '#e74c3c';
                            if (absCorr >= 0.3) return corr > 0 ? '#f1c40f' : '#e67e22';
                            return '#bdc3c7';
                        }),
                        borderColor: correlations.map(corr => {
                            const absCorr = Math.abs(corr);
                            if (absCorr >= 0.7) return corr > 0 ? '#27ae60' : '#c0392b';
                            if (absCorr >= 0.3) return corr > 0 ? '#d4ac0d' : '#d35400';
                            return '#95a5a6';
                        }),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: false,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            min: -1,
                            max: 1,
                            title: {
                                display: true,
                                text: 'ç›¸é—œä¿‚æ•¸',
                                font: {
                                    size: 10
                                }
                            },
                            ticks: {
                                font: {
                                    size: 9
                                }
                            },
                            grid: {
                                color: function(context) {
                                    if (context.tick.value === 0) {
                                        return '#000000';
                                    }
                                    return '#e5e5e5';
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'è®Šæ•¸çµ„åˆ',
                                font: {
                                    size: 10
                                }
                            },
                            ticks: {
                                maxRotation: 0,
                                minRotation: 0,
                                font: {
                                    size: 8
                                }
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'è®Šæ•¸é–“ç›¸é—œä¿‚æ•¸',
                            font: {
                                size: 12
                            }
                        },
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        document.addEventListener('DOMContentLoaded', loadCorrelationData);
    </script>
</body>
</html>